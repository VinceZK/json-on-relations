<nav class="navbar fixed-top navbar-light bg-light">
  <!--<nav class="flex-row" aria-label="breadcrumb">-->
  <!--<ol class="breadcrumb mb-0 p-1 bg-light">-->
  <!--<li class="breadcrumb-item"><a href="#">Home</a></li>-->
  <!--<li class="breadcrumb-item active" aria-current="page">Library</li>-->
  <!--</ol>-->
  <!--</nav>-->
  <div>
    <button class="btn btn-sm btn-light" type="button" aria-label="back" disabled>
      <span class="fas fa-arrow-left"></span>
    </button>
    <button class="btn btn-sm btn-light ml-2" type="button" aria-label="forward">
      <span class="fas fa-arrow-right"></span>
    </button>
  </div>

  <div class="flex-row-reverse">
    <button class="btn btn-sm btn-outline-secondary mr-2" type="button">
      <span class="fab fa-js"> Display Schema</span>
    </button>
    <button class="btn btn-sm btn-outline-secondary mr-2" type="button">
      <span class="fas fa-copy"> Copy</span>
    </button>
    <button class="btn btn-sm btn-outline-secondary mr-2" type="button">
      <span class="fas fa-file"> New</span>
    </button>
    <button class="btn btn-sm btn-outline-primary mr-2" type="button" (click)="toggleEditDisplay()">
      <span *ngIf="!readonly" class="fas fa-glasses"> Display</span>
      <span *ngIf="readonly" class="fas fa-edit"> Edit</span>
    </button>
    <button class="btn btn-sm btn-outline-primary" type="button" (click)="saveEntity()">
      <span class="fas fa-save"> Save</span>
    </button>
  </div>
</nav>

<div class="mt-5">
  <dk-message></dk-message>
</div>

<div class="mt-5" *ngIf="entityMeta">

  <div class="card-body row">
    <div class="form-group row col-6">
      <label class="col-4 col-form-label text-right" for="entityType">Entity Type: </label>
      <div class="col-8">
        <input [value]="entity['ENTITY_ID']" type="text" readonly class="form-control-plaintext" id="entityType">
      </div>
    </div>
    <div class="form-group row col-6">
      <label class="col-4 col-form-label text-right" for="instanceGUID">Instance GUID: </label>
      <div class="col-8">
        <input [value]="entity['INSTANCE_GUID']" type="text" readonly class="form-control-plaintext " id="instanceGUID">
      </div>
    </div>
  </div>

  <app-entity-attribute [formGroup]="formGroup" [entityAttributes]="entityMeta.ATTRIBUTES" [readonly]="readonly">

  </app-entity-attribute>

  <app-entity-relation *ngFor="let entityRelation of entityRelations" [parentFormGroup]="formGroup"
                       [formGroup]="formGroup.controls[entityRelation.RELATION_ID]" [readonly]="readonly"
                       [entityRelation]="entityRelation" [relationAttributes]="entityRelation.ATTRIBUTES" >

  </app-entity-relation>


  <app-entity-relationship *ngFor="let relationship of entity.relationships" [relationship]="relationship" [formGroup]="formGroup"
                           [relationshipMeta]="getRelationshipMeta(relationship.RELATIONSHIP_ID)" [readonly]="readonly">

  </app-entity-relationship>

  <button class="btn btn-sm btn-outline-secondary my-2" type="button"
          [disabled]="readonly" (click)="openAddRelationshipModal()">
    <span class="fas fa-plus "> Add Relationship</span>
  </button>

  <div class="modal fade" [ngClass]="{'show': isModalShown}" [ngStyle]="{'display': displayModal}"
       id="addRelationshipModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addRelationship">Add Relationship</h5>
          <button type="button" class="close" (click)="closeAddRelationshipModal()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="self_role" class="col-form-label form-control-sm">Role:</label>
              <select id="self_role" name="self_role" class="form-control form-control-sm"
                      required [(ngModel)]="toBeAddRelationship.SELF_ROLE_ID">
                <option *ngFor="let role of entityMeta.ROLES" [value]="role.ROLE_ID">{{role.ROLE_ID}}</option>
              </select>
            </div>
            <div class="form-group" *ngIf="toBeAddRelationship.SELF_ROLE_ID">
              <label for="relationship_id" class="col-form-label form-control-sm">Relationship:</label>
              <select id="relationship_id" name="relationship_id" class="form-control form-control-sm"
                      required [(ngModel)]="toBeAddRelationship.RELATIONSHIP_ID">
                <option *ngFor="let relationship of getRelationshipsMeta(toBeAddRelationship.SELF_ROLE_ID)"
                        [value]="relationship.RELATIONSHIP_ID">{{relationship.RELATIONSHIP_ID}}</option>
              </select>
            </div>
            <div class="form-group" *ngIf="toBeAddRelationship.RELATIONSHIP_ID">
              <label for="partner_role" class="col-form-label form-control-sm">Partner Role:</label>
              <select id="partner_role" name="partner_role" class="form-control form-control-sm"
                      required [(ngModel)]="toBeAddRelationship.PARTNER_ROLE_ID">
                <option *ngFor="let involve of getRelationshipInvolvesMeta(toBeAddRelationship.SELF_ROLE_ID, toBeAddRelationship.RELATIONSHIP_ID)"
                        [value]="involve.ROLE_ID">{{involve.ROLE_ID}}</option>
              </select>
            </div>
            <div class="form-group" *ngIf="toBeAddRelationship.PARTNER_ROLE_ID">
              <label for="partner_entity" class="col-form-label form-control-sm">Partner Entity:</label>
              <select id="partner_entity" name="partner_entity" class="form-control form-control-sm"
                      required [(ngModel)]="toBeAddRelationship.PARTNER_ENTITY_ID">
                <option *ngFor="let entity of getPartnerEntityType(toBeAddRelationship.PARTNER_ROLE_ID)"
                        [value]="entity">{{entity}}</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-secondary" (click)="closeAddRelationshipModal()">Cancel</button>
          <button type="button" class="btn btn-sm btn-primary" (click)="addRelationship()">Confirm</button>
        </div>
      </div>
    </div>
  </div>
</div>
